######################################
  - platform: darksky
    api_key: 831db390bfc13337859de91999f50139
#    language: ko
    units: auto
    forecast:
      - 1
      - 2
      - 3
      - 4
      - 5
      - 6
      - 7
    monitored_conditions:
      - precip_probability
      - wind_speed
      - apparent_temperature_high
      - apparent_temperature_low
      - summary
      - pressure
      - temperature
      - humidity
      - wind_speed
      - daily_summary
      - temperature_max
      - apparent_temperature
      - precip_intensity
      - wind_bearing
      - precip_type
      - temperature_high
      - temperature_low
      - nearest_storm_bearing
      - icon

###########wqui air quatliy###############
  - platform: waqi
    token: de3250ec2b25b5d4ca5406f840323ffcc4a83b81
    locations:
      - beijing
    stations:
      - beijing
 
# WAQI: Stations
#
  - platform: template
    sensors:
      aqi_stations:
        friendly_name: Stations AQI
        icon_template: mdi:radar
        entity_id:
          - sensor.waqi_co
        value_template: >-
          {%if states('sensor.waqi_beijing_bei_jing','Co')|int<=25 %}
            Not bad
          {elif states('sensor.waqi_beijing_bei_jing','Co') | int>25 %}
            Bad

      aqi_stations_count:
        friendly_name: Stations AQI Nombre
        icon_template: mdi:radar
        value_template: >-
          {% set stations = states('sensor.aqi_stations') %}
          {% if stations != '' %}
            {{ stations.split('|') | length }}
          {% else %}
            0
          {% endif %}
#
# WAQI: Average
#
  - platform: template
    sensors:
      aqi:
        friendly_name: Qualité de l'air
        icon_template: mdi:chemical-weapon
        entity_id:
          - sensor.time_quarterly
        value_template: >-
          {% set attribute = 'state' %}
          {% set max_hours_behind = 4 %}
          {% set cutoff = (as_timestamp(now())|int - max_hours_behind * 60 * 60) | timestamp_local %}
          {% set stations = states | selectattr('entity_id', 'in', state_attr('group.waqi', 'entity_id'))
                                   | rejectattr('attributes.time', 'lt', cutoff)
                                   | selectattr(attribute)
                                   | map(attribute=attribute)
                                   | map('float')
                                   | list %}
          {% if stations %}
            {{ (stations|sum / stations|length) | round }}
          {% else %}
            unknown
          {% endif %}
      aqi_friendly:
        friendly_name: Qualité de l'air
        icon_template: mdi:chemical-weapon
        value_template: >-
          {% set index = states('sensor.aqi') | float(-1) %}
          {% if index > 300 %}
            Hasardeux
          {% elif index > 200 %}
            Très mauvais
          {% elif index > 150 %}
            Mauvais
          {% elif index > 100 %}
            Mauvais pour les personnes sensibles
          {% elif index > 50 %}
            Modéré
          {% elif index >= 0 %}
            Bon
          {% else %}
            unknown
          {% endif %}








###############this is for 7days forecast###################
  - platform: template
    sensors:
      forecast_1:
        friendly_name_template: >- #'2days later'
          {%- set date=as_timestamp(now())+(0*86400) -%}
          {{ date|timestamp_custom("%A (%m/%-d)") }}
        value_template: "{{states.sensor.dark_sky_daily_high_temperature.state}}°C/{{states.sensor.dark_sky_humidity.state}}/{{states.sensor.dark_sky_wind_speed.state}}m/s"
      forecast_2:
        friendly_name_template: >- #'2days later'
          {%- set date=as_timestamp(now())+(1*86400) -%}
          {{ date|timestamp_custom("%A (%m/%-d)") }}
        value_template: "{{states.sensor.dark_sky_daily_high_temperature_1d.state|round(0)}}°C/{{states.sensor.dark_sky_humidity_1d.state|round(0)}}/{{states.sensor.dark_sky_wind_speed_1d.state}}m/s"
      forecast_3:
        friendly_name_template: >- #'2days later'
          {%- set date=as_timestamp(now())+(2*86400) -%}
          {{ date|timestamp_custom("%A (%m/%-d)") }}
        value_template: "{{states.sensor.dark_sky_daily_high_temperature_2d.state|round(0)}}°C/{{states.sensor.dark_sky_humidity_2d.state|round(0)}}/{{states.sensor.dark_sky_wind_speed_2d.state}}m/s"
      forecast_4:
        friendly_name_template: >- #'2days later'
          {%- set date=as_timestamp(now())+(3*86400) -%}
          {{ date|timestamp_custom("%A (%m/%-d)") }}
        value_template: "{{states.sensor.dark_sky_daily_high_temperature_3d.state|round(0)}}°C/{{states.sensor.dark_sky_humidity_3d.state|round(0)}}/{{states.sensor.dark_sky_wind_speed_3d.state}}m/s"
      forecast_5:
        friendly_name_template: >- #'2days later'
          {%- set date=as_timestamp(now())+(4*86400) -%}
          {{ date|timestamp_custom("%A (%m/%-d)") }}
        value_template: "{{states.sensor.dark_sky_daily_high_temperature_4d.state|round(0)}}°C/{{states.sensor.dark_sky_humidity_4d.state|round(0)}}/{{states.sensor.dark_sky_wind_speed_4d.state}}m/s"
      forecast_6:
        friendly_name_template: >- #'2days later'
          {%- set date=as_timestamp(now())+(5*86400) -%}
          {{ date|timestamp_custom("%A (%m/%-d)") }}
        value_template: "{{states.sensor.dark_sky_daily_high_temperature_5d.state|round(0)}}°C/{{states.sensor.dark_sky_humidity_5d.state|round(0)}}/{{states.sensor.dark_sky_wind_speed_5d.state}}m/s"
      forecast_7:
        friendly_name_template: >- #'2days later'
          {%- set date=as_timestamp(now())+(6*86400) -%}
          {{ date|timestamp_custom("%A (%m/%-d)") }}
        value_template: "{{states.sensor.dark_sky_daily_high_temperature_6d.state|round(0)}}°C/{{states.sensor.dark_sky_humidity_6d.state|round(0)}}/{{states.sensor.dark_sky_wind_speed_6d.state}}m/s"


  - platform: template
    sensors:
      todays_weather:
        value_template: >-
          {% if is_state("sensor.dark_sky_icon", "clear-day") %}
            clear-day
          {% elif is_state("sensor.dark_sky_icon", "clear-night") %}
          clear-night
          {% elif is_state("sensor.dark_sky_icon", "cloudy") %}
          cloudy
          {% elif is_state("sensor.dark_sky_icon", "rain") %}
          rain
          {% elif is_state("sensor.dark_sky_icon", "sleet") %}
          sleet
          {% elif is_state("sensor.dark_sky_icon", "snow") %}
          snow
          {% elif is_state("sensor.dark_sky_icon", "wind") %}
          wind
          {% elif is_state("sensor.dark_sky_icon", "fog") %}
           fog
          {% elif is_state("sensor.dark_sky_icon", "partly-cloudy-day") %}
          partlycloudy
          {% elif is_state("sensor.dark_sky_icon", "partly-cloudy-night") %}
          partlycloudy
          {% else %}
            error
          {% endif %}
      todays_max_temp:
        value_template: >
          {{states.sensor.dark_sky_daily_high_temperature.state|round(0)}}°
      todays_min_temp:
        value_template: >
          {{states.sensor.dark_sky_daily_low_temperature.state|round(0)}}°
  - platform: time_date
    display_options:
      - 'time'
